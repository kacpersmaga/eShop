@{
    ViewData["Title"] = "Forgot Password";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Forgot Password</h2>

<div class="row">
    <div class="col-md-6">
        <form id="forgotPasswordForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" class="form-control" id="email" name="email" required />
            </div>
            <button type="submit" class="btn btn-primary mt-3">Submit</button>
        </form>

        <div id="message" style="margin-top: 15px;"></div>
    </div>
</div>

<script>
    document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const email = document.getElementById('email').value;
        const messageEl = document.getElementById('message');

        messageEl.innerText = "Sending reset instructions...";
        messageEl.style.color = "blue";

        const xsrfToken = getCookie('XSRF-TOKEN');

        try {
            const response = await fetch('/api/auth/forgot-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': xsrfToken
                },
                credentials: 'include',
                body: JSON.stringify({ email })
            });

            const result = await response.json();

            messageEl.style.color = 'green';
            messageEl.innerHTML = `
                <div class="alert alert-success">
                    ${result.message || "If your email is registered, you will receive password reset instructions shortly."}
                    <p>Please check your inbox and spam folders.</p>
                </div>
            `;
            
            document.getElementById('email').value = '';

        } catch (error) {
            messageEl.style.color = 'red';
            messageEl.innerText = 'An error occurred. Please try again.';
        }
    });

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        return parts.length === 2 ? parts.pop().split(';').shift() : "";
    }
</script>